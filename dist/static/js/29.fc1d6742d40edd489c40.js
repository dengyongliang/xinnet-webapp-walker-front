webpackJsonp([29],{"6Qnw":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),o=a.n(r),s=a("NYxO"),n=a("5reh"),l=a("XrW5"),i=a("naar"),c={components:{compInput:l.a},props:{roleData:{type:Object,default:function(){return{data:{}}}},defaultValue:{type:String,default:""},onClose:{type:Function}},data:function(){return{loadingBtn:!1}},methods:o()({formUpdate:function(){var e=this;if(this.loadingBtn=!0,Object(i.a)([this.$refs.roleName])){var t="";t="new"===this.roleData.type?"新建":"修改";var a={param:{menuIds:this.getCheckedNodes().join(",")},callback:function(a){if(e.loadingBtn=!1,!a)return!1;"1000"===a.data.code?(e.$Message.success(t+"成功！"),e.$emit("refreshData")):"100"===a.data.code?e.$Message.error("角色名称已存在"):e.$Message.error("操作失败")}};"new"===this.roleData.type?(a.param.roleName=this.$refs.roleName.value,this.roleCreate(a)):(this.roleData.roleName!==this.$refs.roleName.value&&(a.param.roleName=this.$refs.roleName.value),a.param.roleId=this.$refs.roleId.value,this.roleUpdate(a))}else this.loadingBtn=!1},getCheckedNodes:function(){var e=this.$refs.Tree.getCheckedAndIndeterminateNodes().map(function(e,t,a){return e.title});return e.length||(e=[0]),e},close:function(){this.onClose()},renderContent:function(e,t){t.root,t.node;return e("span",{style:{display:"inline-block",margin:"0 0 0 25px"},on:{click:function(e){}}},[e("span",t.data.label)])},updateForm:function(){}},Object(s.b)({roleCreate:n._53,roleUpdate:n._55})),computed:{},beforeMount:function(){},mounted:function(){}},d={render:function(){var e=this.$createElement,t=this._self._c||e;return t("Form",{attrs:{"label-width":150}},[t("FormItem",{attrs:{label:"角色名称："}},[t("comp-input",{ref:"roleName",attrs:{name:"roleName",label:"角色名称",defaultValue:this.roleData.roleName}}),t("input",{ref:"roleId",attrs:{type:"hidden"},domProps:{value:this.roleData.roleId}})],1),t("FormItem",{attrs:{label:"页面权限勾选："}},[t("div",{staticClass:"roleList"},[t("Tree",{ref:"Tree",attrs:{data:this.roleData.list,"show-checkbox":"show-checkbox",render:this.renderContent}})],1)]),t("FormItem",{attrs:{label:""}},[t("Button",{attrs:{type:"primary",loading:this.loadingBtn},on:{click:this.formUpdate}},[this._v("确定")])],1)],1)},staticRenderFns:[]};var u={components:{compRolesSet:a("VU/8")(c,d,!1,function(e){a("thLY")},"data-v-1e4cce6a",null).exports},data:function(){var e=this;return{refresh:!1,loadingBtn:!1,drawerRolesSet:!1,rolesData:{},columns:[{title:"角色名称",key:"roleName",className:"col1"},{title:"人数",key:"userCount",className:"col2",render:function(t,a){return t("div",[t("span",{},e.list[a.index].userCount+" 人")])}},{title:"操作",key:"operate",className:"operate",render:function(t,a){return t("div",[t("a",{props:{href:"javascript:;"},style:{display:e.list[a.index].roleCode.indexOf("super")>=0?"none":"inline-block"},on:{click:function(){e.showDrawerRole({type:"modify",roleName:e.list[a.index].roleName,roleId:e.list[a.index].id})}}},"修改权限"),t("a",{props:{href:"javascript:;"},style:{display:e.list[a.index].roleCode.indexOf("super")>=0?"none":"inline-block"},on:{click:function(){e.showDelRole(e.list[a.index].id)}}},"删除角色")])}}],list:[],loadingTable:!0,page:{pageNo:1,pagePages:1,pageItems:1},drawerT:""}},methods:o()({searchListData:function(){this.drawerRolesSet=!1,this.queryRoleList(this.queryParam({pageNum:1}))},pageChange:function(e){this.queryRoleList(this.queryParam({pageNum:e}))},showDelRole:function(e){var t=this;this.$Modal.confirm({title:"确认",content:"<p>请确认是否要删除此角色！</p>",loading:!0,onOk:function(){var a={param:{roleId:e},callback:function(e){if(t.$Modal.remove(),!e)return!1;"1000"===e.data.code?(t.$Message.success("删除成功"),t.page.pageNo=1,t.loadingTable=!0,t.searchListData()):"100"===e.data.code?t.$Message.error("角色下有用户，不可删除"):"200"===e.data.code?t.$Message.error("角色不存在"):t.$Message.error("删除失败")}};t.roleDelete(a)},onCancel:function(){}})},showDrawerRole:function(e){var t=this;"new"===e.type?(this.drawerT="新建角色",e.roleName="",e.roleId=""):this.drawerT="修改角色";var a={param:{},callback:function(a){var r={type:e.type,roleName:e.roleName,roleId:e.roleId,list:t.GLOBALS.CONVERT_TREE(a.data.data,{title:"id",label:"menuName",children:"subMenus",checked:"checked"})};t.rolesData=r,t.drawerRolesSet=!0}};e.roleId&&(a.param.roleId=e.roleId),this.queryRoleMenus(a)},drawerChange:function(){this.drawerRolesSet?this.refresh=!0:(this.refresh=!1,this.rolesData={})},closeDrawer:function(){this.drawerRolesSet=!1},queryParam:function(e){var t=this;return this.page.pageNo=e.pageNum,this.loadingTable=!0,{param:{pageNum:e.pageNum,pageSize:20},callback:function(e){if(t.loadingTable=!1,!e)return!1;"1000"===e.data.code?(t.list=e.data.data.list,t.page.pageItems=e.data.data.totalNum):"900"===e.data.code&&t.$Message.error("查询失败")}}}},Object(s.b)({queryRoleList:n._38,queryRoleMenus:n._39,roleDelete:n._54})),computed:o()({},Object(s.d)({maskClosable:function(e){return e.maskClosable}})),beforeMount:function(){this.queryRoleList(this.queryParam({pageNum:1}))},watch:{}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contRoles"},[a("h1",{staticClass:"pageTitle clear"},[e._v("角色管理"),a("div",{staticClass:"tR"},[a("Button",{on:{click:function(t){e.showDrawerRole({type:"new"})}}},[e._v("+ 新建角色")])],1)]),a("div",{staticClass:"secMain"},[a("div",{staticClass:"secTable"},[a("Table",{attrs:{columns:e.columns,data:e.list,loading:e.loadingTable}})],1)]),a("Page",{attrs:{total:e.page.pageItems,current:e.page.pageNo,"show-elevator":"show-elevator","show-total":"show-total","prev-text":"上一页","next-text":"下一页","page-size":20},on:{"on-change":e.pageChange}}),a("Drawer",{attrs:{closable:!0,width:"640",title:e.drawerT,"mask-closable":e.maskClosable},on:{"on-close":function(e){},"on-visible-change":e.drawerChange},model:{value:e.drawerRolesSet,callback:function(t){e.drawerRolesSet=t},expression:"drawerRolesSet"}},[e.refresh?a("comp-roles-set",{attrs:{"on-close":e.closeDrawer,roleData:e.rolesData},on:{refreshData:e.searchListData}}):e._e()],1)],1)},staticRenderFns:[]};var p=a("VU/8")(u,h,!1,function(e){a("XPT4")},"data-v-30135a64",null);t.default=p.exports},XPT4:function(e,t){},thLY:function(e,t){}});
//# sourceMappingURL=29.fc1d6742d40edd489c40.js.map