{"version":3,"sources":["webpack:///src/components/compRolesSet.vue","webpack:///./src/components/compRolesSet.vue?afef","webpack:///./src/components/compRolesSet.vue","webpack:///src/modular/mgmt/roles.vue","webpack:///./src/modular/mgmt/roles.vue?e8bf","webpack:///./src/modular/mgmt/roles.vue"],"names":["compRolesSet","components","compInput","props","roleData","type","Object","default","data","defaultValue","String","onClose","Function","loadingBtn","methods","extends_default","formUpdate","_this","this","validateForm","$refs","roleName","text","params","param","menuIds","getCheckedNodes","join","callback","response","code","$Message","success","$emit","error","value","roleCreate","roleId","roleUpdate","checkedArray","Tree","getCheckedAndIndeterminateNodes","map","val","idx","arr","title","length","close","renderContent","h","_ref","root","node","style","display","margin","on","click","e","label","updateForm","vuex_esm","types","computed","beforeMount","mounted","components_compRolesSet","render","_h","$createElement","_c","_self","attrs","label-width","ref","name","domProps","staticClass","list","show-checkbox","loading","_v","staticRenderFns","roles","__webpack_require__","normalizeComponent","ssrContext","refresh","drawerRolesSet","rolesData","columns","key","className","index","userCount","href","roleCode","indexOf","showDrawerRole","id","showDelRole","loadingTable","page","pageNo","pagePages","pageItems","drawerT","searchListData","queryRoleList","queryParam","pageNum","pageChange","curPage","_this2","$Modal","confirm","content","onOk","remove","roleDelete","onCancel","paramObj","_this3","obj","GLOBALS","CONVERT_TREE","children","checked","console","log","queryRoleMenus","drawerChange","closeDrawer","_this4","pageSize","totalNum","maskClosable","state","watch","mgmt_roles","_vm","$event","total","current","show-elevator","show-total","prev-text","next-text","page-size","on-change","closable","width","mask-closable","on-close","on-visible-change","model","$$v","expression","refreshData","_e","roles_Component","roles_normalizeComponent","__webpack_exports__"],"mappings":"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","file":"static/js/29.fc1d6742d40edd489c40.js","sourcesContent":["<template lang=\"pug\">\r\n  Form(:label-width=\"150\")\r\n    FormItem(label=\"角色名称：\")\r\n      comp-input(name='roleName',label=\"角色名称\",ref=\"roleName\",:defaultValue=\"roleData.roleName\")\r\n      input(type=\"hidden\",ref=\"roleId\",:value=\"roleData.roleId\")\r\n    FormItem(label=\"页面权限勾选：\")\r\n      .roleList\r\n        Tree(:data=\"roleData.list\", show-checkbox, ref=\"Tree\",:render=\"renderContent\",)\r\n    FormItem(label=\"\")\r\n      Button(type=\"primary\",@click=\"formUpdate\",:loading=\"loadingBtn\") 确定\r\n</template>\r\n\r\n<script>\r\nimport {mapActions} from 'vuex'\r\nimport * as types from '@/store/types'\r\nimport compInput from './compInput'\r\nimport validateFormResult from '@/global/validateForm'\r\nexport default {\r\n  components: {\r\n    compInput\r\n  },\r\n  props: {\r\n    roleData: {\r\n      type: Object,\r\n      default: function () {\r\n        return {\r\n          data: {}\r\n        }\r\n      }\r\n    },\r\n    defaultValue: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    onClose: {\r\n      type: Function\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      loadingBtn: false\r\n    }\r\n  },\r\n  methods: {\r\n    formUpdate () {\r\n      this.loadingBtn = true\r\n      let result = validateFormResult([\r\n        this.$refs.roleName\r\n      ])\r\n      if (result) {\r\n        let text = ''\r\n        if (this.roleData.type === 'new') {\r\n          text = '新建'\r\n        } else {\r\n          text = '修改'\r\n        }\r\n        let params = {\r\n          param: {\r\n            menuIds: this.getCheckedNodes().join(',')\r\n          },\r\n          callback: (response) => {\r\n            this.loadingBtn = false\r\n            if (!response) {\r\n              return false\r\n            }\r\n            if (response.data.code === '1000') {\r\n              this.$Message.success(text + '成功！')\r\n              this.$emit('refreshData')\r\n            } else {\r\n              if (response.data.code === '100') {\r\n                this.$Message.error('角色名称已存在')\r\n              } else {\r\n                this.$Message.error('操作失败')\r\n              }\r\n            }\r\n          }\r\n        }\r\n        if (this.roleData.type === 'new') {\r\n          params.param.roleName = this.$refs.roleName.value\r\n          this.roleCreate(params)\r\n        } else {\r\n          if (this.roleData.roleName !== this.$refs.roleName.value) {\r\n            params.param.roleName = this.$refs.roleName.value\r\n          }\r\n          params.param.roleId = this.$refs.roleId.value\r\n          this.roleUpdate(params)\r\n        }\r\n      } else {\r\n        this.loadingBtn = false\r\n      }\r\n    },\r\n    getCheckedNodes () {\r\n      let checkedArray = this.$refs.Tree.getCheckedAndIndeterminateNodes().map((val, idx, arr) => {\r\n        return val.title\r\n      })\r\n      if (!checkedArray.length) {\r\n        checkedArray = [0]\r\n      }\r\n      return checkedArray\r\n    },\r\n    close () {\r\n      this.onClose()\r\n    },\r\n    renderContent (h, {root, node, data}) {\r\n      return h(\r\n        'span', {\r\n          style: {\r\n            display: 'inline-block',\r\n            margin: '0 0 0 25px'\r\n          },\r\n          on: {\r\n            click: (e) => {\r\n            }\r\n          }\r\n        },\r\n        [\r\n          h('span', data.label)\r\n        ]\r\n      )\r\n    },\r\n    updateForm () {\r\n    },\r\n    ...mapActions({\r\n      roleCreate: types.ROLE_CREATE,\r\n      roleUpdate: types.ROLE_UPDATE\r\n    })\r\n  },\r\n  computed: {\r\n  },\r\n  beforeMount () {\r\n  },\r\n  mounted () {\r\n  }\r\n}\r\n</script>\r\n<style scoped>\r\nform{\r\n  padding:50px 0 0 0;\r\n}\r\n.roleList{\r\n  width:300px;\r\n  height:400px;\r\n  border:1px solid #dcdee2;\r\n  padding-left:10px;\r\n  overflow: auto;\r\n}\r\n.ivu-tree{\r\n  position: relative;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/components/compRolesSet.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Form',{attrs:{\"label-width\":150}},[_c('FormItem',{attrs:{\"label\":\"角色名称：\"}},[_c('comp-input',{ref:\"roleName\",attrs:{\"name\":\"roleName\",\"label\":\"角色名称\",\"defaultValue\":_vm.roleData.roleName}}),_c('input',{ref:\"roleId\",attrs:{\"type\":\"hidden\"},domProps:{\"value\":_vm.roleData.roleId}})],1),_c('FormItem',{attrs:{\"label\":\"页面权限勾选：\"}},[_c('div',{staticClass:\"roleList\"},[_c('Tree',{ref:\"Tree\",attrs:{\"data\":_vm.roleData.list,\"show-checkbox\":\"show-checkbox\",\"render\":_vm.renderContent}})],1)]),_c('FormItem',{attrs:{\"label\":\"\"}},[_c('Button',{attrs:{\"type\":\"primary\",\"loading\":_vm.loadingBtn},on:{\"click\":_vm.formUpdate}},[_vm._v(\"确定\")])],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-1e4cce6a\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/template-compiler/preprocessor.js?engine=pug!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/compRolesSet.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-1e4cce6a\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./compRolesSet.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./compRolesSet.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./compRolesSet.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-1e4cce6a\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=pug!../../node_modules/vue-loader/lib/selector?type=template&index=0!./compRolesSet.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-1e4cce6a\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/compRolesSet.vue\n// module id = null\n// module chunks = ","<template lang=\"pug\">\r\n.contRoles\r\n  <!-- 标题区 -->\r\n  h1.pageTitle.clear 角色管理\r\n    .tR\r\n      Button(@click=\"showDrawerRole({type:'new'})\") + 新建角色\r\n  .secMain\r\n    <!-- 列表主体 -->\r\n    .secTable\r\n      <Table :columns=\"columns\" :data=\"list\" :loading=\"loadingTable\"></Table>\r\n  <!-- 翻页区 -->\r\n  Page(:total=\"page.pageItems\",:current=\"page.pageNo\",show-elevator,show-total,prev-text=\"上一页\",next-text=\"下一页\",@on-change=\"pageChange\",:page-size=20)\r\n\r\n  <!-- 权限 抽屉 -->\r\n  Drawer(:closable=\"true\", width=\"640\", v-model=\"drawerRolesSet\", @on-close=\"\", :title=\"drawerT\", :mask-closable=\"maskClosable\", @on-visible-change=\"drawerChange\")\r\n    comp-roles-set(\r\n      @refreshData=\"searchListData\",\r\n      v-if=\"refresh\",\r\n      :on-close=\"closeDrawer\",\r\n      :roleData = 'rolesData'\r\n    )\r\n</template>\r\n\r\n<script>\r\nimport { mapState, mapActions } from 'vuex'\r\nimport * as types from '@/store/types'\r\nimport compRolesSet from '@/components/compRolesSet'\r\nexport default {\r\n  components: {\r\n    compRolesSet\r\n  },\r\n  data () {\r\n    return {\r\n      refresh: false,\r\n      loadingBtn: false,\r\n      drawerRolesSet: false,\r\n      rolesData: {},\r\n      columns: [\r\n        {\r\n          title: '角色名称',\r\n          key: 'roleName',\r\n          className: 'col1'\r\n        },\r\n        {\r\n          title: '人数',\r\n          key: 'userCount',\r\n          className: 'col2',\r\n          render: (h, params) => {\r\n            return h('div', [\r\n              h('span', {\r\n              }, this.list[params.index].userCount + ' 人')\r\n            ])\r\n          }\r\n        },\r\n        {\r\n          title: '操作',\r\n          key: 'operate',\r\n          className: 'operate',\r\n          render: (h, params) => {\r\n            return h('div', [\r\n              h('a', {\r\n                props: {\r\n                  href: 'javascript:;'\r\n                },\r\n                style: {\r\n                  'display': this.list[params.index].roleCode.indexOf('super') >= 0 ? 'none' : 'inline-block'\r\n                },\r\n                on: {\r\n                  click: () => {\r\n                    this.showDrawerRole({\r\n                      type: 'modify',\r\n                      roleName: this.list[params.index].roleName,\r\n                      roleId: this.list[params.index].id\r\n                    })\r\n                  }\r\n                }\r\n              }, '修改权限'),\r\n              h('a', {\r\n                props: {\r\n                  href: 'javascript:;'\r\n                },\r\n                style: {\r\n                  'display': this.list[params.index].roleCode.indexOf('super') >= 0 ? 'none' : 'inline-block'\r\n                },\r\n                on: {\r\n                  click: () => {\r\n                    this.showDelRole(this.list[params.index].id)\r\n                  }\r\n                }\r\n              }, '删除角色')\r\n            ])\r\n          }\r\n        }\r\n      ],\r\n      list: [],\r\n      loadingTable: true,\r\n      page: {\r\n        pageNo: 1,\r\n        pagePages: 1,\r\n        pageItems: 1\r\n      },\r\n      drawerT: ''\r\n    }\r\n  },\r\n  methods: {\r\n    searchListData () {\r\n      this.drawerRolesSet = false\r\n      this.queryRoleList(this.queryParam({pageNum: 1}))\r\n    },\r\n    pageChange: function (curPage) {\r\n      // 根据当前页获取数据\r\n      this.queryRoleList(this.queryParam({pageNum: curPage}))\r\n    },\r\n    showDelRole (roleId) {\r\n      this.$Modal.confirm({\r\n        title: '确认',\r\n        content: '<p>请确认是否要删除此角色！</p>',\r\n        loading: true,\r\n        onOk: () => {\r\n          let params = {\r\n            param: {\r\n              roleId: roleId\r\n            },\r\n            callback: (response) => {\r\n              this.$Modal.remove()\r\n              if (!response) {\r\n                return false\r\n              }\r\n              if (response.data.code === '1000') {\r\n                this.$Message.success('删除成功')\r\n                // 删除成功，重新加载用户列表数据\r\n                this.page.pageNo = 1\r\n                this.loadingTable = true\r\n                this.searchListData()\r\n              } else {\r\n                if (response.data.code === '100') {\r\n                  this.$Message.error('角色下有用户，不可删除')\r\n                } else if (response.data.code === '200') {\r\n                  this.$Message.error('角色不存在')\r\n                } else {\r\n                  this.$Message.error('删除失败')\r\n                }\r\n              }\r\n            }\r\n          }\r\n          this.roleDelete(params)\r\n        },\r\n        onCancel: () => {\r\n        }\r\n      })\r\n    },\r\n    showDrawerRole (paramObj) {\r\n      if (paramObj.type === 'new') {\r\n        this.drawerT = '新建角色'\r\n        paramObj.roleName = ''\r\n        paramObj.roleId = ''\r\n      } else {\r\n        this.drawerT = '修改角色'\r\n      }\r\n      let params = {\r\n        param: {\r\n        },\r\n        callback: (response) => {\r\n          let obj = {\r\n            type: paramObj.type,\r\n            roleName: paramObj.roleName,\r\n            roleId: paramObj.roleId,\r\n            list: this.GLOBALS.CONVERT_TREE(response.data.data,\r\n              {\r\n                title: 'id',\r\n                label: 'menuName',\r\n                children: 'subMenus',\r\n                checked: 'checked'\r\n              }\r\n            )\r\n          }\r\n          this.rolesData = obj\r\n          this.drawerRolesSet = true\r\n        }\r\n      }\r\n      if (paramObj.roleId) {\r\n        params.param.roleId = paramObj.roleId\r\n      }\r\n      console.log(params.param)\r\n      this.queryRoleMenus(params)\r\n    },\r\n    drawerChange () {\r\n      if (this.drawerRolesSet) {\r\n        this.refresh = true\r\n      } else {\r\n        this.refresh = false\r\n        this.rolesData = {}\r\n      }\r\n    },\r\n    closeDrawer () {\r\n      this.drawerRolesSet = false\r\n    },\r\n    queryParam (obj) {\r\n      this.page.pageNo = obj.pageNum\r\n      this.loadingTable = true\r\n      let params = {\r\n        param: {\r\n          pageNum: obj.pageNum,\r\n          pageSize: 20\r\n        },\r\n        callback: (response) => {\r\n          this.loadingTable = false\r\n          if (!response) {\r\n            return false\r\n          }\r\n          if (response.data.code === '1000') {\r\n            this.list = response.data.data.list\r\n            this.page.pageItems = response.data.data.totalNum\r\n          } else {\r\n            if (response.data.code === '900') {\r\n              this.$Message.error('查询失败')\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return params\r\n    },\r\n    ...mapActions({\r\n      queryRoleList: types.QUERY_ROLE_LIST,\r\n      queryRoleMenus: types.QUERY_ROLE_MENUS,\r\n      roleDelete: types.ROLE_DELETE\r\n    })\r\n  },\r\n  computed: {\r\n    ...mapState({\r\n      maskClosable (state) {\r\n        return state.maskClosable\r\n      }\r\n    })\r\n  },\r\n  beforeMount () {\r\n    this.queryRoleList(this.queryParam({pageNum: 1}))\r\n  },\r\n  watch: {\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/modular/mgmt/roles.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"contRoles\"},[_c('h1',{staticClass:\"pageTitle clear\"},[_vm._v(\"角色管理\"),_c('div',{staticClass:\"tR\"},[_c('Button',{on:{\"click\":function($event){_vm.showDrawerRole({type:'new'})}}},[_vm._v(\"+ 新建角色\")])],1)]),_c('div',{staticClass:\"secMain\"},[_c('div',{staticClass:\"secTable\"},[_c('Table',{attrs:{\"columns\":_vm.columns,\"data\":_vm.list,\"loading\":_vm.loadingTable}})],1)]),_c('Page',{attrs:{\"total\":_vm.page.pageItems,\"current\":_vm.page.pageNo,\"show-elevator\":\"show-elevator\",\"show-total\":\"show-total\",\"prev-text\":\"上一页\",\"next-text\":\"下一页\",\"page-size\":20},on:{\"on-change\":_vm.pageChange}}),_c('Drawer',{attrs:{\"closable\":true,\"width\":\"640\",\"title\":_vm.drawerT,\"mask-closable\":_vm.maskClosable},on:{\"on-close\":function($event){},\"on-visible-change\":_vm.drawerChange},model:{value:(_vm.drawerRolesSet),callback:function ($$v) {_vm.drawerRolesSet=$$v},expression:\"drawerRolesSet\"}},[(_vm.refresh)?_c('comp-roles-set',{attrs:{\"on-close\":_vm.closeDrawer,\"roleData\":_vm.rolesData},on:{\"refreshData\":_vm.searchListData}}):_vm._e()],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-30135a64\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/template-compiler/preprocessor.js?engine=pug!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/modular/mgmt/roles.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-30135a64\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./roles.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./roles.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./roles.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-30135a64\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=pug!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./roles.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-30135a64\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/modular/mgmt/roles.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}