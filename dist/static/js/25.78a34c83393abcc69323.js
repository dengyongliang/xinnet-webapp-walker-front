webpackJsonp([25],{"6Qnw":function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=t("Dd8w"),o=t.n(r),s=t("NYxO"),n=t("5reh"),l=t("XrW5"),i=t("naar"),c={components:{compInput:l.a},props:{roleData:{type:Object,default:function(){return{data:{}}}},defaultValue:{type:String,default:""},onClose:{type:Function}},data:function(){return{loadingBtn:!1}},methods:o()({formUpdate:function(){var e=this;if(this.loadingBtn=!0,Object(i.a)([this.$refs.roleName])){var a="";a="new"===this.roleData.type?"新建":"修改";var t={param:{menuIds:this.getCheckedNodes().join(",")},callback:function(t){e.loadingBtn=!1,"1000"===t.data.code?(e.$Message.success(a+"成功！"),e.$emit("refreshData")):"100"===t.data.code?e.$Message.error("角色名称已存在"):e.$Message.error("操作失败")}};"new"===this.roleData.type?(t.param.roleName=this.$refs.roleName.value,this.roleCreate(t)):(this.roleData.roleName!==this.$refs.roleName.value&&(t.param.roleName=this.$refs.roleName.value),t.param.roleId=this.$refs.roleId.value,this.roleUpdate(t))}else this.loadingBtn=!1},getCheckedNodes:function(){var e=this.$refs.Tree.getCheckedAndIndeterminateNodes().map(function(e,a,t){return e.title});return e.length||(e=[0]),e},close:function(){this.onClose()},renderContent:function(e,a){a.root,a.node;return e("span",{style:{display:"inline-block",margin:"0 0 0 25px"},on:{click:function(e){}}},[e("span",a.data.label)])},updateForm:function(){}},Object(s.b)({roleCreate:n._53,roleUpdate:n._55})),computed:{},beforeMount:function(){},mounted:function(){}},d={render:function(){var e=this.$createElement,a=this._self._c||e;return a("Form",{attrs:{"label-width":150}},[a("FormItem",{attrs:{label:"角色名称："}},[a("comp-input",{ref:"roleName",attrs:{name:"roleName",label:"角色名称",defaultValue:this.roleData.roleName}}),a("input",{ref:"roleId",attrs:{type:"hidden"},domProps:{value:this.roleData.roleId}})],1),a("FormItem",{attrs:{label:"页面权限勾选："}},[a("div",{staticClass:"roleList"},[a("Tree",{ref:"Tree",attrs:{data:this.roleData.list,"show-checkbox":"show-checkbox",render:this.renderContent}})],1)]),a("FormItem",{attrs:{label:""}},[a("Button",{attrs:{type:"primary",loading:this.loadingBtn},on:{click:this.formUpdate}},[this._v("确定")])],1)],1)},staticRenderFns:[]};var u={components:{compRolesSet:t("VU/8")(c,d,!1,function(e){t("sjWy")},"data-v-4d63635a",null).exports},data:function(){var e=this;return{refresh:!1,loadingBtn:!1,drawerRolesSet:!1,rolesData:{},columns:[{title:"角色名称",key:"roleName",className:"col1"},{title:"人数",key:"userCount",className:"col2",render:function(a,t){return a("div",[a("span",{},e.list[t.index].userCount+" 人")])}},{title:"操作",key:"operate",className:"operate",render:function(a,t){return a("div",[a("a",{props:{href:"javascript:;"},style:{display:e.list[t.index].roleCode.indexOf("super")>=0?"none":"inline-block"},on:{click:function(){e.showDrawerRole({type:"modify",roleName:e.list[t.index].roleName,roleId:e.list[t.index].id})}}},"修改权限"),a("a",{props:{href:"javascript:;"},style:{display:e.list[t.index].roleCode.indexOf("super")>=0?"none":"inline-block"},on:{click:function(){e.showDelRole(e.list[t.index].id)}}},"删除角色")])}}],list:[],loadingTable:!0,page:{pageNo:1,pagePages:1,pageItems:1},drawerT:""}},methods:o()({searchListData:function(){this.drawerRolesSet=!1,this.queryRoleList(this.queryParam({pageNum:1}))},pageChange:function(e){this.queryRoleList(this.queryParam({pageNum:e}))},showDelRole:function(e){var a=this;this.$Modal.confirm({title:"确认",content:"<p>请确认是否要删除此角色！</p>",loading:!0,onOk:function(){var t={param:{roleId:e},callback:function(e){a.$Modal.remove(),"1000"===e.data.code?(a.$Message.success("删除成功"),a.page.pageNo=1,a.loadingTable=!0,a.searchListData()):"100"===e.data.code?a.$Message.error("角色下有用户，不可删除"):"200"===e.data.code?a.$Message.error("角色不存在"):a.$Message.error("删除失败")}};a.roleDelete(t)},onCancel:function(){}})},showDrawerRole:function(e){var a=this;"new"===e.type?(this.drawerT="新建角色",e.roleName="",e.roleId=""):this.drawerT="修改角色";var t={param:{},callback:function(t){var r={type:e.type,roleName:e.roleName,roleId:e.roleId,list:a.GLOBALS.CONVERT_TREE(t.data.data,{title:"id",label:"menuName",children:"subMenus",checked:"checked"})};a.rolesData=r,a.drawerRolesSet=!0}};e.roleId&&(t.param.roleId=e.roleId),console.log(t.param),this.queryRoleMenus(t)},drawerChange:function(){this.drawerRolesSet?this.refresh=!0:(this.refresh=!1,this.rolesData={})},closeDrawer:function(){this.drawerRolesSet=!1},queryParam:function(e){var a=this;return this.page.pageNo=e.pageNum,this.loadingTable=!0,{param:{pageNum:e.pageNum,pageSize:20},callback:function(e){a.loadingTable=!1,"1000"===e.data.code?(a.list=e.data.data.list,a.page.pageItems=e.data.data.totalNum):"900"===e.data.code&&a.$Message.error("查询失败")}}}},Object(s.b)({queryRoleList:n._38,queryRoleMenus:n._39,roleDelete:n._54})),computed:o()({},Object(s.d)({maskClosable:function(e){return e.maskClosable}})),beforeMount:function(){this.queryRoleList(this.queryParam({pageNum:1}))},watch:{}},h={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"contRoles"},[t("h1",{staticClass:"pageTitle clear"},[e._v("角色管理"),t("div",{staticClass:"tR"},[t("Button",{on:{click:function(a){e.showDrawerRole({type:"new"})}}},[e._v("+ 新建角色")])],1)]),t("div",{staticClass:"secMain"},[t("div",{staticClass:"secTable"},[t("Table",{attrs:{columns:e.columns,data:e.list,loading:e.loadingTable}})],1)]),t("Page",{attrs:{total:e.page.pageItems,current:e.page.pageNo,"show-elevator":"show-elevator","show-total":"show-total","prev-text":"上一页","next-text":"下一页","page-size":20},on:{"on-change":e.pageChange}}),t("Drawer",{attrs:{closable:!0,width:"640",title:e.drawerT,"mask-closable":e.maskClosable},on:{"on-close":function(e){},"on-visible-change":e.drawerChange},model:{value:e.drawerRolesSet,callback:function(a){e.drawerRolesSet=a},expression:"drawerRolesSet"}},[e.refresh?t("comp-roles-set",{attrs:{"on-close":e.closeDrawer,roleData:e.rolesData},on:{refreshData:e.searchListData}}):e._e()],1)],1)},staticRenderFns:[]};var p=t("VU/8")(u,h,!1,function(e){t("96NO")},"data-v-6e8faafe",null);a.default=p.exports},"96NO":function(e,a){},sjWy:function(e,a){}});
//# sourceMappingURL=25.78a34c83393abcc69323.js.map